\chapter{Migrace archivu z formátu \texttt{arc} do formátu \texttt{warc}}
\section{O migraci}
\subsection{Úvod}
Pøevod \texttt{arc} archivù do formátu \texttt{warc} je specifický problém. Rùzné instituce pou¾ívají rùzné formáty na ukládání webových zdrojù. Vìt¹ina tìchto institucí bude mít právì snahu pøevést ulo¾ená data do formátu warc.

Informace o migraci nejsou snadno dostupné. To je zpùsobené pøedev¹ím tím, ¾e problematika je relativnì nová. Formát \texttt{warc} byl standardizován v roce 2009. Migraèní nástroje jsou sice vyhledatelné na internetu, ale vìt¹inou není jejich souèástí kompletní dokumentace.

Problém dostupnosti informací o migraci je pøedev¹ím v tom, ¾e ka¾dá instituce, která se archivací zabývá, pou¾ívá jiné nástroje. Ka¾dá instituce si bìhem své existence pøizpùsobila nástroje pro své potøeby. Tyto potøeby mù¾e tvoøit napøíklad jazykové, dostupnost nástrojù, rozdílnost legislativy, rozdílnost v politice ukládání webových zdrojù. Proto, pokud urèitá instituce analyzuje problematiku migrace, zabývá se problémy specifickými pro její podmínky.

Proto napøíklad informace získané z Britské knihovny jsou pro Web\-Archiv hodnotné, ale ve skuteènosti nejsou jejich nástroje okam¾itì pou¾itelné. Pokud by je chtìli pracovníci WebArchivu vyu¾ít bylo by nutné je pøedìlat pro jejich potøeby.
\subsection{Britská knihovna}
Øe¹itelé projektu WebArhiv se migrací prozatím pøíli¹ nezabývali. Nic\-ménì ve svìtì se tím ji¾ lidé zabývají. Proto jsem se pokusil zjistit informace o migraci u pracovníkù z Britské knihovny. Mojí mailovou korespondenci uvádím v \texttt{pøíloze Q na s. \pageref{pr:q}}. V Britské knihovnì vyzkou¹el vývojový tým skript pro pøevod do archivního formátu warc u¾ v roce 2009. Celkovì bylo pøevedeno cca 4,4 TB dat.

O pøevodu, který provedli, zatím není dostatek informací. Pracovníci Britské knihovny v¹ak pou¾ili pro migraci nástroje, které nejsou pøímo pou¾itelné ve WebArchivu. Pou¾ívali toti¾ jiné nástroje pro ukládání dat a práci s archivy -- \texttt{Web Curator Tool} a \texttt{PANDAS}. Pøekvapilo mì, ¾e nevyu¾ili ani mo¾nosti deduplikace souborù.\cite{PROKOP2012}


\section{Pou¾ité nástroje}
Kromì samotných nástrojù pro migrci arc archivù jsem pou¾íval i jiné nástroje, zde podávám jejich pøehled.
\subsection{\texttt{JHOVE}}
Slou¾í k identifikaci a validaci souborù. Program disponuje mno¾stvím modulù pro rozpoznávání formátù souborù. V \texttt{pøíloze F na s. \pageref{pr:f}} je dostupná ukázka výstupu programu \texttt{JHOVE} pro \texttt{arc} soubor. Program je pou¾íval jen k pokusnému testování souborù.

Konkrétnì program umo¾òuje identifikaci, validaci a charakterizaci digitálních objektù. Identifikace je proces, který urèuje formát objektu. Validace urèuje stupeò korespondence daného objektu se specifikací pøíslu¹ného formátu. Charakterizace navíc informuje o specifických vlastnostech daného objektu.

Tyto operace jsou potøebné pøi správì digitálního archivu. Jeho pou¾ití je nutné pøi uchovávání digitálních souborù. Øe¹itelé projektu Webarchiv musí nutnì vìdìt, jaké typy souborù uchovávají v repositáøích. Jedním z hlavních dùvodù je mo¾nost zpìtné pøevoditelnosti uchovaných webových zdrojù a jejich interpretace\footnote{Rùzné verze elektronických dokumentù je mo¾no zobrazit správnì pouze specifickými nástroji. Proto je potøeba mít informace o tom, jaké verze dokumentù archiv obsahuje.}.

JHOVE obsahuje moduly pro práci s \texttt{bytestreamy}, \texttt{ASCII} a \texttt{UTF-8} texty, \texttt{AIFF} a \texttt{WAVE} audio soubory. Dále s obrázky typu \texttt{GIF, JPEG, JPEG 2000, TIFF}, také \texttt{PDF soubory}, textovými a \texttt{XML output hand\-le\-ry}. Je naprogramován v programovacím jazyce \texttt{Java}.

Jeliko¾ je ji¾ zastaralý, pou¾íval jsem pro svou práci jeho novìj¹í verzi: \texttt{JHOVE2}. Pøesto je tento nástroj stále vyvíjen a dostupný k volnému sta¾ení\footnote{Webové stránky projektu \texttt{JHOVE} dostupné online na adrese \texttt{http://sourceforge.net/projects/jhove}.}.

\subsection{\texttt{JHOVE2}}
\subsubsection{Úvod}
Program je novìj¹í verzí ji¾ zmínìného programu \texttt{JHOVE}. Slou¾í k validaci a identifikaci souborù. Program je vyvíjen v mnoha variantách\footnote{Distribuované verzovací systémy umo¾òují pøi vývoji projektu v urèitém checkpointu rozdìlit zdrojový kód na dvì èásti (forky) a pracovat na nich nezávisle. Pøièem¾ checkpoint reprezentuje v¹echny dostupnými komponentami projektu. Pøehled rùzných variant projektu \texttt{JHOVE2} dostupný online na adrese \texttt{https://bitbucket.org/jhove2/main/descendants}.} -- v rámci distribuovaného verzovacího systému \texttt{Mercurial} na serveru www.bitbucket.com. Je vyvíjen \texttt{JHOVE2} Project Team -- California Digital Library, Portico, Stanford University .

Proto¾e je \texttt{JHOVE2} vyvíjen mnoha rùznými vývojáøi, vznikají rùzné verze tohoto programu se specifickými druhy pøidané funkcionality. Pro mé úèely jsem pou¾il oficiální verzi\footnote{Webová stránka projektu \texttt{JHOVE2} dostupná online na adrese \texttt{https://bitbucket.org/jhove2}.} a dále verzi urèenou pro validaci testování souborù\footnote{Webová stránka projektu \texttt{JHOVE2-BNF} dostupná online na adrese \texttt{https://bitbucket.org/lbihanic/jhove2-bnf/overview}.}, která má zásuvný modul pro analýzu \texttt{arc} souborù.

Program jsem pou¾il pro zji¹tìní obsahu pøevádìných \texttt{arc} archivù. Je toti¾ potøeba pøesnì zjistit obsah archivu. Jeliko¾ pøi vytváøení archivù dochází obèas k tomu, ¾e není správnì identifikován \texttt{mimetype} archivovaných souborù. Tato informace je v¹ak zásadní pro zpìtnou interpretaci obsahu sta¾ených souborù. V \texttt{pøíloze G a O ma s. \pageref{pr:g}} je ukázka výstupu z nástroje pro \texttt{arc} a \texttt{warc} soubor. \texttt{Pøíloha AH na s. \pageref{pr:ah}} obsahuje archiv s nástrojem \texttt{JHOVE2}. 

Implementací a analýzou nìkolika archivù z depozitáøe WebArchivu se zabývám v jiné kapitole.

\subsubsection{Podrobnìj¹í informace JHOVE2}
Detailní informace o programu jsou obsa¾eny v u¾ivatelské pøíruèce \footnote{V celé kapitole pou¾ívám pøi popisu funkcí a vlastností nástroje vlastní pøeklady z této pøíruèky.}, která je k nahlédnutí v \texttt{pøíloze AF na s. \pageref{pr:af}}. Dal¹í podstatné informace lze nalézt v dokumentu z roku 2010, který se vìnuje aktualizaci nástroje, je pøilo¾en k bakaláøské práci v \texttt{pøíloze AG na s. \pageref{pr:ag}}. Nástroj je napsán v programovacím jazyce Java a ke svému správnému bìhu vy¾aduje \texttt{The OpenSP SGML parser}\footnote{Webová stránka \texttt{The OpenSP SGML parser} dostupná online na adrese \texttt{http://search.cpan.org/dist/SGML-Parser-OpenSP/}}.

Jak jsem zmínil vý¹e, program \texttt{JHOVE2} je novìj¹í verzí programu \texttt{JHOVE} a jako takový pøiná¹í nové mo¾nosti a funkcionality. Hlavní zmìnou je to, ¾e u objektù provádí charakterizaci, která je oproti pùvodním partikulárním testovacím procesùm u JHOVE komplexnìj¹í. \uv{\textit{Characterization is the process of examining a formatted digital source unit and automatically extracting or deriving representation information about that source unit that is indicative of its significant nature and useful for purposes of classification, analysis, and use.}}\cite{JHOVE2}\\ \\
\noindent Charakterizace se skládá ze ètyø procedur \cite{JHOVE2}: 
\begin{description}
\item[Identifikace] urèení formátu objektu.
\item[Feature extraction (extrakce rysù)] urèení charakteristických rysù objektu.
\item[Validace] urèení stupnì korespondence objektu se specifikací formátu.
\item[Assessment] urèení stupnì korespondence objektu se specifickými nároky urèenými u¾ivatelem softwaru. Nástroj je tedy mo¾no \uv{personalizovat} pro potøeby u¾ivatele, co¾ je výhodné hlavnì proto, ¾e témìø ka¾dá organizace zabývající se archivací webových zdrojù, pou¾ívá odli¹nou politiku archivace dat. Nástroj poté dovede napøíklad urèit rizika pøi práci s rùznými objekty, nebo provést èi doporuèit dal¹í akce ke zpracování objektù.
\end{description}
\noindent \\ Mezi dal¹í pøednosti programu patøí \cite{JHOVE2}:
\begin{itemize}
\item Modulární architektura a práce s plug-iny
\item Jednoduché \texttt{API} a design základních modulù
\item \texttt{Bufferovaní I/O} operací
\item Internacionalizovaný výstup: podporuje více formátù -- \texttt{JSON, XML}, text.
\item ©iroká mo¾nost konfigurace nástroje
\item Kompletní dokumentace nástroje
\item ©iroká ¹kála rozpoznatelných objektù\footnote{V následujícím odstavci podávám pouze neúplný výèet podporovaných objektù, podrobný výèet lze nalézt v \texttt{pøíloze AG na s. \pageref{pr:ag}}.}
\end{itemize}
Hlavní pøedností nástroje je samozøejmì ¹iroká ¹kála typù souborù, které doká¾e identifikovat a validovat. Identifikovat doká¾e \texttt{JHOVE2} v¹ech\-ny objekty obsa¾ené v databázi \texttt{PRONOM}\footnote{Organizace zabývající se problematikou souborových formátù a softwarových produkù s nimi souvisejících. Webové stránky databáze \texttt{PRONOM} dostupné online na adrese \texttt{http://www.nationalarchives.gov.uk/PRONOM}.}, respektive objekty, které definují \texttt{DROID signature files}\footnote{\texttt{DROID} (Digital Record Object Identificatio), je nástroj pro automatickou identifikaci formátu souborù. Webové stránky nástroje \texttt{DROID} dostupné online na adrese \texttt{http://droid.sourceforge.net}.} -- jedná se o více ne¾ 550 formátù. Výèet typù objektù, které dovede \texttt{JHOVE2} validovat obsahuje formáty èi standardy jako: \texttt{ICC color profile, JPEG 2000, PDF, SGML, Shape\-file, TIFF, UTF-8, WAVE, XML, Zip}.

Nástroj tedy poskytuje velký potenciál pro vyu¾ití v pøi øe¹ení problému s archivací webových zdrojù. Je podporován a u¾íván velkým mno¾stvím organizací a dá se øíci, ¾e patøí mezi uznávaný a standardní nástroj.
 \cite{JHOVE2}

\subsection{\texttt{Jpype}}
Nástroj umo¾òující spu¹tìní programù napsaných v programovacím jazyce \texttt{Java} v rámci programu napsaného v programovacím jazyce \texttt{Python}. Pou¾ití tohoto nástroje bylo nutné kvùli tomu, ¾e nástroje pro migraci arc archivù jsou psány v programovacím jazyce \texttt{Python}, ale \texttt{JHOVE2} je programován jazyce \texttt{Java}.

Nástroj v podstatì umo¾ní spu¹tìní \texttt{Java Virtual Machine}\footnote{Webové stránky \texttt{Java} dostupné online na adrese \texttt{http://www.java.com}.} uvnitø \texttt{Python} skriptu a následnì práci s Java aplikací. Nástroj je dostupný volnì ke sta¾ení na webových stránkách\footnote{Webové stránky projektu \texttt{Jpype} dostupná online na adrese \texttt{http://jpype.sourceforge.net}.} jeho vývojáøù. Jeho vyu¾ití bylo zásadní pro mo¾nost testování pøevádìných \texttt{arc} archivù. V \texttt{pøíloze AI na s. \pageref{pr:ai}} je archiv s nástrojem \texttt{Jpype}.

\section{Testování migraèních nástrojù}
Migraci realizuji pomocí nìkolika variant nastrojù \texttt{WARC-TOOLS}. Pokusím se pøevést vzorek arc archivù a porovnat výsledky. Z informací, které získám pokusím poukázat na výhody a nevýhody jednotlivých nástrojù.
\subsection{\texttt{WARC-TOOLS}}
Sada nástrojù pro práci s \texttt{arc} a \texttt{warc} soubory. Skripty jsou napsány v nìkolika programovacích jazycích -- \texttt{C, Python, Ruby}.
Souèástí sady skriptù jsou jak skripty pro pøevod archivù, tak skripty pro analýzy warc souborù. Jedná se konkrétnì o \texttt{warcdump} a \texttt{warcvalidator}. Bohu¾el \texttt{WARC-TOOLS} neobsahuje i nástroje na práci s {warc} archivy. 

Tento nástroj není ji¾ v souèasnosti dále vyvíjen a podporován, ale je stále dostupný ke sta¾ení\footnote{Webové stránky projektu \texttt{WARCTOOLS} dostupná online na adrese \texttt{http://code.google.com/p/warc-tools/}.}. Na webových stránkách projektu je dostupná dokumentace, kterou nabízím v \texttt{pøílohách R, S, T a U na s. \pageref{pr:r}}. \texttt{Pøíloha O na s. \pageref{pr:o}} obsahuje výpis z programu \texttt{JHOVE2} pro \texttt{warc} archiv generovaný tímto nástrojem. \texttt{Pøíloha V na s. \pageref{pr:v}} obsahuje výstup z nástroje \texttt{warcdump} pro \texttt{warc} archiv. V \texttt{pøíloze L na s. \pageref{pr:l}} je \texttt{warc} archiv generovaný nástrojem \texttt{WARCTOOLS}. \texttt{Pøíloha AC na s. \pageref{pr:ac}} obsahuje kompletní nástroj.
\subsubsection{Kompatibilita s ostatními nástroji}
\noindent Nástroj \texttt{warcdump} není kompatibilní s ostatními mnou testovanými nástroji.
\begin{itemize}
\item pro \texttt{WARC-TOOLS / hanzo} hlásí: \texttt{Incompatible Warc Version}
\item pro \texttt{WARC-TOOLS / kpk09} hlásí: \texttt{Incompatible Warc Version}
\item pro soubory typu \texttt{arc} hlásí: \texttt{Incompatible Warc Version}
\end{itemize}
\noindent \\ Nástroj \texttt{warcvalidator} není kompatibilní s ostatními testovanými nástroji.
\begin{itemize}
\item pro \texttt{WARC-TOOLS / hanzo} hlásí: \texttt{Incompatible Warc Version}
\item pro \texttt{WARC-TOOLS / kpk09} hlásí: \texttt{Incompatible Warc Version}
\item pro soubory typu \texttt{arc} hlásí: \texttt{Incompatible Warc Version}
\end{itemize}
Nástroj tedy není pøímo kompatibilní s ostatními mnou testovanými nástroji.
\subsubsection{Dal¹í parametry}
\begin{itemize}
\item Výhodou nástroje je, ¾e má napsané skripty pro hromadnou migraci.
\item Zvládá pøevádìt soubory \texttt{arc} i soubory \texttt{arc.gz}.
\item Pøi pøevodu \texttt{arc} souboru do \texttt{warc} archivu pøibalí i archivované soubory. Na rozdíl od ostatních nástrojù -- ostatní nástroje pøibalí archivované soubory pouze pokud dostanou na vstup \texttt{arc} archivy, které jsou zabalené nástrojem \texttt{GZip}. 
\item Nástroj není v souèasné dobì dále vyvíjen. Z toho se dá odvodit, ¾e pravdìpodobnì nebude mo¾no pou¾ívat ho dlouhodobì -- ostatní nástroje budou obohacovány o dal¹í funkcionalitu a tím reagovat na nové po¾adované parametry k pøevodu \texttt{arc} souborù.
\end{itemize}

\subsection{\texttt{WARC-TOOLS / hanzo}}
Dal¹í nástroj obsahující skripty pro pøevod \texttt{arc} souborù na \texttt{warc} soubory, vèetnì nástrojù pro validaci a práci s \texttt{warc} soubory. Tento nástroj vyvíjí tým, který je odvozen od týmu vyvíjejícího pùvodní \texttt{WARC-TOOLS}\footnote{Webové stránky projektu \texttt{WARC-TOOLS / hanzo} dostupné online na adrese \texttt{http://code.hanzoarchives.com/warc-tools/wiki/Home}.}.

V \texttt{pøíloze W na s. \pageref{pr:w}} je k nalezení dokumentace nástroje. \texttt{Pøíloha X na s. \pageref{pr:x}} obsahuje výstup z nástroje \texttt{warcdump} a \texttt{pøíloha Y na s. \pageref{pr:y}} výstup z nástroje \texttt{JHOVE2} pro daný \texttt{warc} soubor. \texttt{Pøíloha AD na s. \pageref{pr:ad}} obsahuje kompletní nástroj.
\subsubsection{Kompatibilita s ostatními nástroji}
\begin{itemize}
\item Nástroj \texttt{warcdump} je kompatibilní s ostatními testovanými nástroji.
\item Z nástroje zcela vychází nástroj \texttt{WARC-TOOLS / kpk09}.
\item Dokumentace nástroje s nástrojem \texttt{WARC-TOOLS / kpk09} je toto¾ná.
\end{itemize}
\subsubsection{Dal¹í parametry}
\begin{itemize}
\item Nemá napsané skripty pro hromadnou migraci.
\item Pøi pøevodu \texttt{arc} souborù nepøibalí k souboru data. Je potøeba mu dávat na vstup \texttt{arc.gz} soubory.
\item Po otestování na zku¹ebním vzorku je textový \texttt{warc} soubor, toto¾ný se souborem z \texttt{WARCTOOLS / kpk09}.
\item Nástroj je v souèasné dobì vyvíjen.
\item Nástroj nemá dokonèenou dokumentaci. V manuálu stojí, ¾e vytváøí \uv{crappy} \texttt{warc} soubory. Nástroj pro migraci je údajnì pøevzat z nástroje \texttt{WARCTOOLS}.\cite{Hanzo}
\end{itemize}

\subsection{\texttt{WARC-TOOLS / kpk09}}
Tøetí mnou testovaný nástroj na urèený pro migraci \texttt{arc} souborù. Jedná se o projekt, který je vyvíjen jako fork k pùvodnímu kódu \texttt{WARC TOOLS / hanzo}\footnote{Webové stránky projektu \texttt{WARC-TOOLS / kpk09} dostupné online na adrese \texttt{https://bitbucket.org/kpk09/warc-tools/wiki/Home}.}.
V \texttt{pøíloze Z na s. \pageref{pr:z}} je k nalezení dokumentace nástroje. \texttt{Pøíloha AA na s. \pageref{pr:aa}} obsahuje výstup z nástroje \texttt{warcdump} a \texttt{pøíloha AB \pageref{pr:ab}} výstup z nástroje \texttt{JHOVE2} pro daný \texttt{warc} soubor. \texttt{Pøíloha AE na s. \pageref{pr:ae}} obsahuje kompletní nástroj.
\subsubsection{Kompatibilita s ostatními nástroji}
\begin{itemize}
\item Nástroj \texttt{warcdump} je kompatibilní s ostatními testovanými nástroji.
\item Nástroj zcela vychází z nástroje \texttt{WARC-TOOLS / hanzo}.
\item Dokumentace nástroje s nástrojem \texttt{WARC-TOOLS / hanzo} je toto¾ná.
\end{itemize}
\subsubsection{Dal¹í parametry}
\begin{itemize}
\item Nemá napsané skripty pro hromadnou migraci.
\item Pøi pøevodu \texttt{arc} souborù nepøibalí k souboru data. Je potøeba mu dávat na vstup \texttt{arc.gz} soubory.
\item Po otestování na zku¹ebním vzorku je textový \texttt{warc} soubor, toto¾ný se souborem z \texttt{WARCTOOLS / hanzo}.
\item Nástroj je v souèasné dobì vyvíjen.
\item Nástroj nemá dokonèenou dokumentaci. V manuálu stojí, ¾e vytváøí \uv{crappy} \texttt{warc} soubory. Nástroj pro migraci je údajnì pøevzat z nástroje \texttt{WARCTOOLS}.\cite{Kpk09}
\end{itemize}

\section{Podobnost \texttt{WARCTOOLS / hanzo s kpk09}}
Jak jsem zmínil ji¾ vý¹e nástroje \texttt{WARCTOOLS / hanzo} s \texttt{WARCTOOLS /\\ kpk09} jsou si velmi podobné. Tato podobnost logicky vychází z toho, ¾e \texttt{WARCTOOLS / kpk09} vychází z nástroje druhého.
Pokud bychom chtìli dùslednì porovnávat tyto dva nástroje mù¾eme to udìlat dvìma zpùsoby. První zpùsob je porovnání výstupù pro stejný vstup a druhý je porovnání zdrojového kódu.
\subsection{Porovnání výstupù pro stejné vstupy}
Testoval jsem nástroje pro pøevod na vlastním vzorku \texttt{arc} archivù. Konkrétnì jsem testoval podobnost pøíslu¹ných dvou \texttt{warc.gz} archivù a jejich výstupù pøi pou¾ití nástroje \texttt{warcdump}. Výstupy z nástroje \texttt{warcdump} jsem porovnával pomocí nástroje \texttt{diff}\footnote{Informace o nástroji \texttt{diff} dostupné online na adrese \texttt{http://unixhelp.ed.ac.uk/CGI/man-cgi?diff}.}. Výsledky byli a¾ na názvy cest k archivùm toto¾né. Testování samotných \texttt{warc.gz} souborù jsem provádìl pomocí nástroje \texttt{zdiff}\footnote{Informace o nástroji \texttt{zdiff} dostupné online na adrese \texttt{http://resin.csoft.net/cgi-bin/man.cgi?section=1\&topic=zdiff}. }, i tento nástroj potvrdil toto¾nost souborù.

Musím zdùraznit, ¾e jsem pou¾il relativnì malý testovací vzorek. Proto abych mohl uspokojivì konstatovat, bych musel pou¾ít mnohem vìt¹í vzorek dat. Navíc bych musel testovat archivy s rùzným obsahem -- dá se oèekávat, ¾e by mohlo dojít k iferenciaci výstupù, kdyby archivy obsahovali atypické typy souborù.
\subsection{Porovnání zdrojového kódu}
Porovnání zdrojového kódu je nároènìj¹í procedura, ale pravdìpodobnì mù¾e jasnì odpovìdìt na otázku. Pravdìpodobnì by bylo nejlep¹í dotázat se na rozdílnost obou nástrojù pøímo vývojáøù. 
Server, na kterém jsou oba nástroje umístìny, umo¾òuje pøímé porovnávání pomocí nástroje \texttt{diff}. Informace o rozdílnosti je mo¾né zhlédnout z dvou hledisek.
\begin{itemize}
\item Zmìny ve \texttt{WARCTOOLS / hanzo}, které se neprojevily v druhém nástroji\footnote{Náhled zmìn mezi porovnávanými nástroji dostupný online na adrese \texttt{https://bitbucket.org/kpk09/warc-tools/compare/hanzo/warc-tools}. 11.4.2012 ¹lo o modifikace ve 34 souborech.}. 
\item Zmìny ve \texttt{WARCTOOLS /kpk09}, které se neprojevily v druhém nástroji\footnote{Náhled zmìn mezi porovnávanými nástroji dostupný online na adrese \texttt{https://bitbucket.org/kpk09/warc-tools/compare/..hanzo/warc-tools}. 11.4.2012 ¹lo o modifikace ve 7 souborech.}.
\end{itemize}

\section{Závìry z porovnávání nástrojù}
Na základì porovnání jednotlivých nástrojù, které rozvádím v pøedcházející kapitole, jsem po poradì se svým vedoucím, Mgr. Václevem Roseckým, do¹el k závìru, ¾e nejlep¹ím nástrojem pro pøípadný pøevod webového archivu bude nástroj \texttt{WARCTOOLS / hanzo}.

Hlavní výhoda tohoto nástroje je to, ¾e je neustále vyvíjen a za jeho vývojem stojí organizace Hanzo Archives.

\section{Implementace úprav v migraèních nástrojích}
\subsection{Úvod}
Mým úkolem bylo najít zpùsob, jak pøi procesu migrace na \texttt{warc }archiv zjistit obsah pùvodního archivu. To znamená, ¾e jsem mìl v prùbìhu migrace provést analýzu obsahu archivu. V prùbìhu pøevodu znamená taková analýza nejmen¹í re¾ii, oproti dodateènému provádìní takové analýzy. Navíc by analýza mohla potencionálnì ovlivnit samotný pøevod, jeliko¾ by v pøípadì nutnosti bylo mo¾no zmìnit obsah pøevádìného archivu, pøed tím ne¾ bude ulo¾en do \texttt{warc} archovu.

Z toho dùvodu jsem musel provést nìkolik zmìn v programu \texttt{JHOVE2} i nástroji \texttt{WARCTOOLS}, respektive jsem zmìnu provedl jen v nástroji \texttt{WARCTOOLS / hanzo}. Zmìna v ostatních nástrojích \texttt{WARCTOOLS} by znamenala obdobné zásahy do zdrojového kódu, a pravdìpodobnì by vedla je stejným výsledkùm, jak vyplývá z mého porovnání nástrojù.
\subsection{Úprava \texttt{JHOVE2}}
Program \texttt{JHOVE2} je implementován v programovacím jazyce \texttt{Java}. Jeliko¾ je napsán tak, aby ho bylo mo¾né spou¹tìt z pøíkazového øádku, musel jsem provést zmìny, který by mi umo¾nili spou¹tìt jej pøímo z tìla programu \texttt{WARCTOOLS}. Bylo tedy nutno implementovat v rámci programu \texttt{JHOVE2} dal¹í tøídu.

Moje nová tøída je tedy spu¹tìna pøímo z programu \texttt{arc2warc.py}\footnote{Souèást nástroje WARCTOOLS, která je urèena k migraci archivù. Do jiných programù v rámci WARCTOOLS jsem nemusel zasahovat.} a obstará inicializaci a pøedání instrukcí nástroji \texttt{JHOVE2}, který pak provede v¹echny operace a vytvoøí výstupní soubor s informacemi o analýze obsahu \texttt{arc} archivu. Problémem bylo, ¾e program \texttt{HOVE2} neumo¾òuje vícenásobné spu¹tìní, jeliko¾ pro ka¾dé spu¹tìní musí znova inicializovat \texttt{Berkeley DB} databázi -- co¾ by pøi implementaci do programu \texttt{arc2warc} pùsobilo problémy. Proto mnou implementovaná tøída umo¾òuje, aby mohl zpracovat libovolné mno¾ství souborù najednou, a vrátit pro nì souhrnný soubor s informace o analýze.

Ukázku této tøídy je mo¾no najít v \texttt{pøíloze AK a na s. \pageref{pr:ak}}. 
\subsection{Úprava WARCTOOLS / hanzo}
Pøi úpravì nástroje \texttt{WARCTOOLS} staèilo upravit pouze program \texttt{arc2warc\-.py}, který je implementovám v programovacím jazyce \texttt{Python}. Bylo nutné provést takové zmìny, aby bylo mo¾no pøímo pøi bìhu programu spustit aplikaci v programovacím \texttt{Java}. A upravit program tak, aby bylo mo¾no pøistupovat k jednotlivým souborùm uvnitø \texttt{arc} archivu. Dal¹ím problémem bylo, ¾e program \texttt{JHOVE2} neumo¾òuje vícenásobné spu¹tìní. Opakovaná inicializace by v¹ak byla výpoèetnì velmi nároèná\footnote{Typický archiv je má velikost 100 MB a obsahuje stovky a¾ tisíce souborù.}.

Pro úèely spou¹tìní \texttt{Java} aplikace v rámci rámci skriptu v jazyce \texttt{Python} bylo tøeba vybrat vhodný nástroj. Vybíral jsem mezi nástroji \texttt{Jpype} a \texttt{Jython}\footnote{Webové stránky projektu \texttt{JYTHON} dostupné online na adrese \texttt{http://www.jython.org}.}. Nástroj Jpype umo¾òuje spu¹tìní \texttt{Java Virtual Machine} uvnitø skriptu v jazyce \texttt{Python}, oproti tomu nástroj \texttt{Jython} spustí \texttt{Java Virtual Machine} je¹tì pøed samotným vykonáváním skrip\-tu. Nakonec jsem zvolil nástroj \texttt{Jpype}, který mi pøi¹el vhodnìj¹í. Hlavnì proto¾e v dobì volby nástroje jsem se domníval, ¾e budu potøebovat spou¹tìt \texttt{Java Virtual Machine} vícekrát bìhem prùbìhu skriptu.

Pùvodní program pøevádí \texttt{arc} archiv tak, ¾e pøedìlá metadata uvnitø archivu a jeho obsah -- soubory v nìm obsa¾ené -- pouze jako \texttt{bytestream} pøevede do nového \texttt{warc} archivu. Mùj výsledný upravený program pracuje tak, ¾e bìhem pøevodu archivu provede pomocí regulárního výrazu filtrování jednotlivých souborù uvnitø archivu. Ty ulo¾í do doèasného adresáøe. Potom, co je \texttt{warc} archiv vytvoøený, spustí se \texttt{JHOVE2}, který provede analýzu v¹ech souborù v archivu. Nakonec jsou soubory z doèasného adresáøe odstranìny.

Jako výstup z migrace, je kromì nového \texttt{warc} archivu i soubor ve formátu \texttt{XML} vytvoøený programem \texttt{JHOVE2}, který obsahuje souhrn analýzy souborù.

Ukázku upraveného programu \texttt{arc2warc.py} pod názvem \texttt{arc2warc\-\_jhove2.py} nabízím v \texttt{pøíloze AL na s. \pageref{pr:al}}, kde jsou i moje komentáøe k úpravám zdrojového kódu.
\section{Výstupy z analýzy obsahu pøevádìných archivù}
Svùj program \texttt{arc2warc\_jhove2.py} jsem otestoval pøi pøevodu nìkolika souborù \texttt{arc.gz}, které jsem pomocí nástroje Heritrix sám sklidil.

V \texttt{pøíloze AP na s. \pageref{pr:ap}} nabízím \texttt{warc} soubor, který vznil pøevodem testovacího \texttt{arc.gz} archivu z \texttt{pøílohy E na s. \pageref{pr:e}}. \texttt{Pøíloha AQ na s. \pageref{pr:aq}} obsahuje výstup z nástroje \texttt{JHOVE2} pro tuto testovací migraci.

Jak se dalo pøedem oèekávat migrace spojená s testováním obsahu archivu je èasovì velmi nároèná. Pøi testování standardních 100 MB souborù \texttt{arc.gz} se èas migrace dosahoval témìø dvou minut, pøièem¾ pøevod neupraveným nástrojem -- bez pou¾ití programu \texttt{JHOVE2} -- trvá do 25 sekund.

Hlavním problémem je zde tedy èasová nároènost programu \texttt{JHOVE2}. Rovnì¾ manipulace s analýzou bude velmi nároèná, jeliko¾ výstupní soubor z analýzy dosahuje velikosti 42 MB. Velikost výstupního souboru i èas operace je samozøejmì pøímo úmìrný poètu souborù obsa¾ených v archivu. 

Ke zefektivnìní nástroje by se pravdìpodobnì dalo dojít tak, ¾e by se v rámci nástroje \texttt{JHOVE2} implementovala tøída, která by umo¾nila pøímou charakterizaci souborù, bez nutnosti vytváøení doèasných souborù na disku. Taká zmìna v¹ak není vzhledem k rozsahu nástroj \texttt{JHOVE2} jednoduchá. Nástroj \texttt{JHOVE2} je vyvíjen týmem lidí,. který mìl zøejmì dùvod takouto u¾iteènou funkcionalitu neimplementovat.

